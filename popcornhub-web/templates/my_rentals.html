{% extends "base.html" %}
{% block title %}Mes locations{% endblock %}

{% block content %}
<div class="container my-4">
  <h1 class="mb-4">Mes locations</h1>

  {% if rentals and rentals|length > 0 %}

    <div class="profile-rentals-grid">
      {% for r in rentals %}
        <article class="profile-rental-card">

          <div class="profile-rental-poster">
            {% set poster = r.poster_url or r.affiche_url %}
            {% if poster %}
              <img src="{{ poster }}"
                   alt="Affiche de {{ r.titre }}"
                   class="img-fluid rounded-3">
            {% else %}
              <div class="profile-rental-poster-placeholder">
                <span>Affiche indisponible</span>
              </div>
            {% endif %}
          </div>

          <div class="profile-rental-body">

            <h2 class="profile-rental-title">
              {{ r.titre }}
              {% if r.annee %}
                <span class="text-muted">({{ r.annee }})</span>
              {% endif %}
            </h2>

            {% if r.realisateur %}
              <p class="text-light mb-1 small">
                Réalisateur : {{ r.realisateur }}
              </p>
            {% endif %}

            <p class="profile-rental-dates mb-1 small">
              Loué le
              <strong>{{ r.rented_at[:16].replace('T',' ') }}</strong>
              – jusqu'au
              <strong>{{ r.expires_at[:16].replace('T',' ') }}</strong>
            </p>

            <p class="mb-2 small">
              {% if r.is_active %}
                <span class="badge bg-success">En cours</span>
              {% else %}
                <span class="badge bg-secondary">Expirée</span>
              {% endif %}

              <span class="profile-rental-price text-light ms-2">
                {{ "%.2f"|format(r.price_eur) }} €
              </span>
            </p>

            <div class="d-flex gap-2 mt-3">

              {% if r.is_active %}

                <form method="post"
                      action="{{ url_for('return_rental', rental_id=r.id) }}"
                      class="flex-grow-1">
                  <button type="submit"
                          class="btn btn-danger w-100 fw-semibold">
                    Rendre
                  </button>
                </form>

              {% else %}
                <a href="{{ url_for('films_bp.film_detail', film_id=r.film_id) }}"
                   class="btn btn-outline-light w-100 flex-grow-1">
                  Relouer
                </a>
              {% endif %}

            </div>

          </div>

        </article>
      {% endfor %}
    </div>

  {% else %}
    <p class="text-light">Vous n'avez pas encore loué de films.</p>
  {% endif %}
</div>
{% endblock %}